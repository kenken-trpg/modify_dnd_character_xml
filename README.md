# D&D 5e ユドナリウム用キャラクターシートXML修正ツール 🐉🎲

## 概要

このツールは、D&D 5eのキャラクターシートXMLファイル（特にユドナリウムでの使用を想定）を、より使いやすくするためのPythonスクリプトです。
プログラミングの知識がない方でも、簡単なコマンド操作でXMLファイルを修正できます。

**🎮主な機能:**

*   キャラクターシートのXMLに「参照URL」欄を追加。※欄の追加のみです。入力は手動で行う必要があります。
*   「ヒット・ポイント」を「HP」に、「イニシアチブ」を「イニシアチブ修正」に名称変更し、「イニシアチブ」欄も残置。「THP」(一時的ヒットポイント)欄を追加。
      - イニシアチブを上書きして、修正値をキャラシーまで見に行かなくて済む！
      - THP（一時的HP）がわかりやすい！
      - HP表示がインベントリでコンパクト！
*   呪文データを自動的に`chat-palette`に整形して追加。
*   「特徴等」のデータ（背景、人格的特徴など）を`chat-palette`に追加。

## 🛠動作環境

*   Python 3.6 以上 (3.7, 3.8, 3.9, 3.10, 3.11, 3.12 で動作確認済み)
*   (Windows, macOS, Linux)

## 🚀使い方

### 📥 ダウンロード方法
1. 緑色の`Code`ボタンをクリック
2. `Download ZIP`を選択
3. 解凍したフォルダ内の`xml_character_updater.py`を使用
   
### 1. 準備

1.  **Pythonのインストール:**  もしPythonがインストールされていない場合は、[Python公式サイト](https://www.python.org/downloads/)からダウンロードしてインストールしてください。
2.  **スクリプトのダウンロード:** このリポジトリをクローンするか、`dnd_character_sheet_modifier.py` (またはあなたが選んだファイル名) をダウンロードしてください。
3.  **キャラクターシートの登録：** D&D総合コミュニティ　D&D5E キャラクターデータベース（安定版）
     - https://dndjp.sakura.ne.jp/LIST.php に登録
5.  **コマ作成:** D&D5Eプレイヤーキャラクター コマ作成　でURLからコマ作成　※URL貼付時はs抜きの`http://`で
     - https://direboar.github.io/githubpage-test/dist/#/Udonarium/PlayerCharacter 
7.  **xmlファイル取り出し取り出す:** ダウンロードしたzipファイルからxmlファイルを取り出す。

### 1-B. 準備

形式が一致していれば下記方法も可能
1.  **ユドナリウムからキャラクターデータをエクスポート**: ユドナリウムでキャラクターを作成、または既存のキャラクターデータを開き、「コマをファイルに保存」でzipファイルを出力します。
2.  **xmlファイル取り出し取り出す:** ダウンロードしたzipファイルからxmlファイルを取り出す。

### 2. 実行

1.  **ターミナル/コマンドプロンプトを開く:**
    *   **Windows:**  `Windowsキー + R` を押し、「cmd」と入力してEnter。
    *   **macOS:**  `Finder` -> `アプリケーション` -> `ユーティリティ` -> `ターミナル` を開く。
    *   **Linux:**  通常、`Ctrl + Alt + T` でターミナルを開くことができます。
2.  **スクリプトとXMLファイルを置いたフォルダに移動:**
    *   `cd` コマンドを使います。例えば、デスクトップに `dnd_xml` というフォルダを作り、そこにスクリプトとXMLファイルを置いた場合：
        *   **Windows:** `cd C:\Users\あなたのユーザー名\Desktop\dnd_xml`
        *   **macOS/Linux:** `cd /Users/あなたのユーザー名/Desktop/dnd_xml`
        * `cd ~/Desktop/dnd_xml` (macOS/Linuxでホームディレクトリからの相対パスを使う場合)
3.  **スクリプトの実行:**
    ```bash
    python dnd_character_sheet_modifier.py input.xml
    ```
    *   `python` (または `python3`): Pythonを実行するコマンド。
    *   `dnd_character_sheet_modifier.py`:  ダウンロードしたスクリプトの名前 (別の名前にした場合は適宜変更してください)。
    *   `input.xml`:  変更したいキャラクターシートのXMLファイル名 (ユドナリウムからエクスポートしたファイル) に置き換えてください。

    実行すると、`modified_input.xml` というファイルが作成されます（`input.xml`の部分は元のファイル名）。これが変更されたXMLファイルです。

4. **出力ファイル名の指定(オプション):**

   `-o` オプションを使うと出力ファイル名を指定できます

   ```bash
    python dnd_character_sheet_modifier.py input.xml -o my_character.xml
   ```


この場合、`my_character.xml` という名前で出力されます。

3. ユドナリウムへのインポート

ユドナリウム画面上に、xmlファイルをドロップしてください。

**仕組み (技術的な詳細)**


このスクリプトは、Pythonの標準ライブラリである xml.etree.ElementTree, argparse, os, re, pathlib を使用しています。
- xml.etree.ElementTree: XMLファイルの読み込み、解析、変更、書き出しを行います。
- argparse: コマンドライン引数 (入力ファイル名、出力ファイル名) を処理します。
- os: ファイルシステムの操作 (ファイルの存在確認など) を行います。
- re: 正規表現を使って、chat-palette 内のテキストを検索・置換します。
- pathlib: ファイルパスをオブジェクトとして扱い、出力ファイル名を生成します。


スクリプトは、大きく分けて以下の4つの処理を行っています。
- 共通データの変更 (modify_common_data): 参照URL 欄を追加。
- 行動データの変更 (modify_action_data): HP、THP、イニシアチブ関連の項目名を変更/追加。
- 呪文データの処理 (modify_spell_data): XML内の呪文データを抽出し、整形して chat-palette に追加。
- 特徴データの処理 (modify_feature_data): XML内の特徴データ（背景、人格的特徴など）を抽出し、chat-palette に追加。


### 📝注意点
このスクリプトは、ユドナリウムの特定のバージョンのXML形式を想定して作成されています。ユドナリウムの仕様変更により、将来的に動作しなくなる可能性があります。
XMLファイルの構造が大きく異なる場合（例えば、他のツールで作成されたキャラクターシート）は、正しく動作しない可能性があります。


### 謝辞
D&D5Eプレイヤーキャラクター コマ作成 みのくば
D&D総合コミュニティ　D&D5E キャラクターデータベース（安定版）運営者
ユドナリウム開発チーム
D&D 5e 開発元
